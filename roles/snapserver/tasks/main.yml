---

- name: Exit play if os_family is not Debian
  ansible.builtin.fail:
    msg: "ERROR: os_family of host {{ inventory_hostname }} is not Debian"
  when: ansible_facts['os_family'] != "Debian"

- name: Install snapserver package
  ansible.builtin.apt:
    name: snapserver
    state: latest
    update_cache: yes

- name: Install snapserver config
  ansible.builtin.template:
    src: templates/etc/snapserver.conf.j2
    dest: /etc/snapserver.conf
    backup: yes
  notify:
    - Restart snapserver

- name: Add snapserver user to audio group
  ansible.builtin.user: 
    name: _snapserver
    append: yes
    groups: audio

- name: Enable snapserver to start on boot
  ansible.builtin.systemd:
    name: snapserver
    enabled: yes
  ignore_errors: "{{ ansible_check_mode }}"
